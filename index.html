<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>相册</title><!-- 标签图标 --><link rel="icon" type="image/png" sizes="32x32" href="assets/images/icon/rose.png"><!-- 移动端兼容 --><meta name="viewport" content="width=device-width,initial-scale=1"><!-- SEO --><meta name="keywords" content="free html5, free template, free bootstrap, html5, css3, mobile first, responsive"><!-- 基础样式 --><link rel="stylesheet" href="https://cdn.qiniu.songxingguo.com/css/base.css"><!-- Flex 布局 --><link rel="stylesheet" href="https://cdn.qiniu.songxingguo.com/css/flex.css"><!-- Grid 布局 --><link rel="stylesheet" href="https://cdn.qiniu.songxingguo.com/css/grid.css"><!-- 字体图标 --><link rel="stylesheet" href="assets/css/icon.css"><!-- 页面样式 --><style>.container{width:100%;padding:50px 0;background-color:#fff}.img-item+.img-item{width:100%}.img-box{width:70vw;height:calc(70vw / 3 * 2);margin:0 auto 30px;--shadow-color:rgba(73, 78, 60, 0.3);--color-top:#8d9584;--color-middle:#747769;--color-bottom:#494e3c;box-shadow:0 16px 60px 0 rgba(73,78,60,.3),0 16px 12px 0 rgba(0,0,0,.1);border-radius:2px;overflow-y:hidden;transition:-webkit-box-shadow 1s;transition:box-shadow 1s,-webkit-box-shadow 1s;-webkit-background-repeat:no-repeat;-webkit-background-position:center;-webkit-background-size:cover;-moz-background-repeat:no-repeat;-moz-background-position:center;-moz-background-size:cover;-o-background-repeat:no-repeat;-o-background-position:center;-o-background-size:cover;background-repeat:no-repeat;background-position:center;background-size:cover}.img{width:inherit;height:inherit;background-size:cover;-webkit-transition:opacity 1s ease-out;transition:opacity 1s ease-out;opacity:0}.desc-box{padding:20px 0 50px}.desc-item+.desc-item{margin-left:40px}.desc-item__name{margin-bottom:6px;font-size:12px;text-align:center;text-transform:uppercase;color:#9b9b9b;margin-bottom:6px}.desc-item__desc{text-decoration:none;color:#505050;font-size:14px}.param-item+.param-item{margin-left:12px}.param-item .iconfont{font-size:14px}.param__value{vertical-align:middle;padding-left:5px;font-size:12px;color:#505050}.icon_star{font-size:18px}#loading{position:fixed;bottom:10px}@media screen and (max-width:750px){.img-box{width:100vw;height:calc(100vw / 3 * 2);margin:0}.desc-box{width:100vw;padding-top:40px;margin:0;overflow:auto}.desc-item{min-width:200px}.desc-item+.desc-item{margin:0}}</style></head><body><!-- 页面结构 --><div id="main" class="container flex-column flex-items-center"></div><!-- 引入 jQuery --><script src="https://cdn.qiniu.songxingguo.com/js/jquery-3.4.1.min.js"></script><!-- 时间格式库 --><script src="https://cdn.qiniu.songxingguo.com/js/moment.min.js"></script><!--渐变色获取--><script src="https://cdn.qiniu.songxingguo.com/js/grade.js"></script><!-- 页面逻辑 --><script>const loadData=e=>{const n="https://net.songxingguo.workers.dev/album/imgs?limit=5&marker="+e;return new Promise(e=>{$.ajax(n,{type:"get",timeout:1e4,success:({marker:n,data:s})=>{e({marker:n,imgs:s})},error:()=>{console.log("请求失败")}})})},loadImage=(e,n)=>{const s=new Image;s.src=e,s.setAttribute("class","img"),s.setAttribute("crossOrigin","anonymous"),s.style.opacity=1,s.complete?n(s):s.onload=function(){n(s)}},getImgInfo=e=>{const n=e+"?exif";return new Promise(e=>{$.ajax(n,{type:"get",timeout:1e4,success:n=>{e(Exif(n))},error:()=>{console.log("请求失败")}})})},batchGetImgInfo=e=>Promise.all(e.map(async e=>{const{url:n}=e,s=n+"/watermark",a=await getImgInfo(s);return new Promise(n=>{n(Object.assign(e,{exif:a}))})}));function Exif({DateTime:e,ExposureTime:n,FNumber:s,FocalLength:a,Model:i,ISOSpeedRatings:t}={}){return{dateTime:e.val,exposureTime:n.val,fNumber:s.val,focalLength:a.val,model:i.val,ISO:t.val}}const render=e=>{e.forEach(async e=>{const{hash:n,address:s,grade:a,url:i,img:t,exif:l}=e,{dateTime:c,exposureTime:o,fNumber:r,focalLength:m,model:d,ISO:f}=l,p=s.replace(/-/g,"·");let g="";for(let e=1;e<=7;e++){g+=`<li><i class="iconfont ${e<=a?"icon_stared":"icon_star"}"></i></li>`}const u=$("#main"),x=`<section class="img-item flex-column flex-all-center">\n    <div id="img${n}" class="img-box gradient-wrap">\n\x3c!--        <img src="${i}" class="img" crossorigin="anonymous" alt="">--\x3e\n\x3c!--        <div class="img"></div>--\x3e\n    </div>\n    <ul class="desc-box flex-row flex-content-between">\n      <li class="desc-item flex-column flex-items-center">\n        <span class="desc-item__name">评级</span>\n        <ul class="flex-row flex-items-center">\n          ${g}\n        </ul>\n      </li>\n      <li class="desc-item flex-column flex-items-center">\n        <span class="desc-item__name">参数</span>\n        <ul class="flex-row flex-items-center">\n          <li class="param-item flex-row flex-items-center">\n            <i class="iconfont icon_focus"></i>\n            <span class="param__value">${parseInt(m)}mm</span>\n          </li>\n          <li class="param-item flex-row flex-items-center">\n            <i class="iconfont icon_aperture"></i>\n            <span class="param__value">f/${parseFloat(r.split("/")[1])}</span>\n          </li>\n          <li class="param-item flex-row flex-items-center">\n            <i class="iconfont icon_time"></i>\n            <span class="param__value">${o.replace(" sec.","")}</span>\n          </li>\n          <li class="param-item flex-row flex-items-center">\n            <i class="iconfont icon_iso"></i>\n            <span class="param__value">${f}</span>\n          </li>\n        </ul>\n      </li>\n      <li class="desc-item flex-column flex-items-center">\n        <span class="desc-item__name">地点</span>\n        <a class="desc-item__desc" href="javascript:;">\n          ${p}\n        </a>\n      </li>\n      <li class="desc-item flex-column flex-items-center">\n        <span class="desc-item__name">日期</span>\n        <a class="desc-item__desc" href="javascript:;">\n          ${moment(c,"YYYY:MM:DD HH:mm:ss").format("YYYY年MM月DD日 HH:mm")}\n        </a>\n      </li>\n      <li class="desc-item flex-column flex-items-center">\n        <span class="desc-item__name">相机</span>\n        <a class="desc-item__desc" href="javascript:;">\n          ${d}\n        </a>\n      </li>\n    </ul>\n  </section>`;u.append(x);loadImage(i+"/tiny",(function(e){$("#img"+n).append(e),setTimeout((function(){Grade(document.querySelector("#img"+n))}),200)}))})},renderLoading=e=>{e?$("#main").append('<div id="loading">加载中...</div>'):$("#loading").remove()};let nMarker="",isLoading=!1,isLast=!1;const beforeLoadData=async()=>{if(isLoading||isLast)return;isLoading=!0,renderLoading(isLoading);const{marker:e,imgs:n}=await loadData(nMarker);return isLoading=!1,renderLoading(isLoading),nMarker=e,await batchGetImgInfo(n),render(n),e?void 0:isLast=!0};(async()=>{await beforeLoadData()})(),$(window).scroll(async()=>{const e=$(this).scrollTop(),n=$(document).height();e+$(this).height()>=n-500&&await beforeLoadData()})</script><script type="text/javascript">window.addEventListener("load",(function(){Grade(document.querySelectorAll(".gradient-wrap"))}))</script><script src="bundle.js"></script></body></html>